<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Virtual Labs</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  </head>
  <body>
    <!-- sidebar and body -->
    <div class="flex min-h-[80vh]">
      <div class="px-6 pb-6 flex-1">
        <div class="flex flex-shrink-0">
          <div class="relative w-[700px] py-2">
            <div
              class="z-10 absolute bg-[#0000ff] h-2 w-[170px] rounded-md top-[252px] left-[136px]"
            ></div>
            <div
              class="absolute bg-[#ff0000] h-[128px] w-2 rounded-md top-[132px] right-[250px]"
            ></div>
            <div
              class="z-10 absolute bg-[#ff0000] h-2 w-[80px] rounded-md top-[252px] right-[252px]"
            ></div>
            <div
              class="z-10 absolute bg-[#ff0000] h-2 w-[90px] rounded-md top-[130px] right-[168px]"
            ></div>

            <div
              class="z-10 absolute bg-[#ffff00] h-[200px] w-2 rounded-md top-[340px] left-[210px]"
            ></div>
            <div
              class="z-10 absolute bg-[#ffff00] h-[88px] w-2 rounded-md top-[254px] left-[10px]"
            ></div>

            <div
              class="z-10 absolute bg-[#ffff00] h-2 w-[68px] rounded-md top-[532px] left-[150px]"
            ></div>
            <div
              class="z-10 absolute bg-[#ffff00] h-2 w-[65px] rounded-md top-[252px] left-[10px]"
            ></div>
            <div
              class="z-10 absolute bg-[#ffff00] h-2 w-[208px] rounded-md top-[338px] left-[10px]"
            ></div>
            <div class="flex justify-between p-8 pb-20">
              <!-- BUFFER AMPLIFIERS  -->
              <div
                class="relative bg-[#a9a9a9] p-1 pt-0 border-4 shadow-[5px_5px_5px_5px_rgba(0,0,0,0.6)] border-black w-[140px] h-[250px]"
              >
                <h5 class="text-center text-sm font-medium">
                  BUFFER AMPLIFIERS
                </h5>
                <div class="flex justify-around py-1">
                  <div class="flex flex-col items-center">
                    <div
                      class="h-[24px] w-[24px] bg-[#ffff00] flex justify-center items-center rounded-full"
                    >
                      <div
                        class="h-[14px] w-[14px] bg-[#000] rounded-full"
                      ></div>
                    </div>
                    <p class="text-[12px] font-medium">A</p>
                  </div>
                  <div class="flex flex-col items-center">
                    <div
                      class="h-[24px] w-[24px] bg-[#ffff00] flex justify-center items-center rounded-full"
                    >
                      <div
                        class="h-[14px] w-[14px] bg-[#000] rounded-full"
                      ></div>
                    </div>
                    <p class="text-[12px] font-medium">k1.A</p>
                  </div>
                </div>
                <div class="absolute bottom-0 w-full flex justify-around">
                  <div class="flex flex-col items-center">
                    <div
                      class="h-[24px] w-[24px] bg-[#ffff00] flex justify-center items-center rounded-full"
                    >
                      <div
                        class="h-[14px] w-[14px] bg-[#000] rounded-full"
                      ></div>
                    </div>
                    <p class="text-[12px] font-medium">B</p>
                  </div>
                  <div class="flex flex-col items-center">
                    <div
                      class="h-[24px] w-[24px] bg-[#ffff00] flex justify-center items-center rounded-full"
                    >
                      <div
                        class="h-[14px] w-[14px] bg-[#000] rounded-full"
                      ></div>
                    </div>
                    <p class="text-[12px] font-medium">k2.B</p>
                  </div>
                </div>
              </div>
              <!-- vco -->
              <div
                class="relative bg-[#a9a9a9] p-1 pt-0 border-4 shadow-[5px_5px_5px_5px_rgba(0,0,0,0.6)] border-black w-[140px] h-[250px]"
              >
                <h5 class="text-center text-sm font-medium">VCO</h5>
                <div class="flex justify-around py-1">
                  <div class="flex flex-col items-center">
                    <div
                      class="h-[24px] w-[24px] bg-[#ff0000] flex justify-center items-center rounded-full"
                    >
                      <div
                        class="h-[14px] w-[14px] bg-[#000] rounded-full"
                      ></div>
                    </div>
                    <p class="text-[12px] font-medium">DATA</p>
                  </div>
                  <div class="flex flex-col items-center">
                    <div
                      class="h-[24px] w-[24px] bg-[#ff0000] flex justify-center items-center rounded-full"
                    >
                      <div
                        class="h-[14px] w-[14px] bg-[#000] rounded-full"
                      ></div>
                    </div>
                    <p class="text-[12px] font-medium">TTL</p>
                  </div>
                </div>
                <!--  -->
                <div class="flex absolute bottom-0 w-full justify-around">
                  <div class="flex flex-col items-center">
                    <div
                      class="h-[24px] w-[24px] flex justify-center items-center bg-[#ffff00] rounded-full"
                    >
                      <div
                        class="h-[14px] w-[14px] bg-[#000] rounded-full"
                      ></div>
                    </div>
                    <p class="text-[12px] font-medium">Vin</p>
                  </div>
                  <div class="flex flex-col items-center">
                    <div
                      class="h-[24px] w-[24px] flex justify-center items-center bg-[#ffff00] rounded-full"
                    >
                      <div
                        class="h-[14px] w-[14px] bg-[#000] rounded-full"
                      ></div>
                    </div>
                    <p class="text-[12px] font-medium">sin(wt)</p>
                  </div>
                </div>
                <div class="absolute -bottom-48">
                  <!-- message frequency -->
                  <div class="flex flex-col mb-2 items-center">
                    <p class="text-[13px] pb-1 text-center font-bold">
                      Message Frequency
                    </p>
                    <input
                      id="messageFrequency"
                      value="1"
                      type="range"
                      min="1"
                      max="10000"
                      onchange="handleMessageFrequencyChange()"
                    />
                    <div class="leading-none messageFrequencyDiv">1</div>
                    <button
                      onclick="generateMessage()"
                      class="bg-[#008000] py-[2px] px-3 mt-1 rounded-md hover:bg-[#0c9c0c] hover:scale-105"
                    >
                      Generate
                    </button>
                  </div>
                  <!-- carrier frequency -->
                  <div class="flex flex-col items-center">
                    <p class="text-[13px] pb-1 font-bold">Carrier Frequency:</p>
                    <input
                      id="carrierFrequency"
                      value="10"
                      type="range"
                      min="1"
                      max="10000"
                      onchange="handleCarrierFrequencyChange()"
                    />
                    <div class="leading-none carrierFrequencyDiv">1</div>
                    <button
                      onclick="generateCarrier()"
                      class="bg-[#008000] py-[2px] px-3 mt-1 rounded-md hover:bg-[#0c9c0c] hover:scale-105"
                    >
                      Generate
                    </button>
                  </div>
                  <!--  -->
                </div>
              </div>
              <!-- frequency counter -->
              <div
                class="relative bg-[#a9a9a9] p-1 pt-0 border-4 shadow-[5px_5px_5px_5px_rgba(0,0,0,0.6)] border-black w-[170px] h-[250px]"
              >
                <h5 class="text-center text-sm font-medium">
                  Frequency Counter
                </h5>
                <div class="flex flex-col pl-3 pt-[58px] pb-[53px]">
                  <div
                    class="h-[24px] w-[24px] flex justify-center items-center relative bg-[#ffff00] rounded-full"
                  >
                    <div class="h-[14px] w-[14px] bg-[#000] rounded-full"></div>
                  </div>
                  <p class="">ANALOG</p>
                </div>
                <div
                  class="flex absolute items-center bottom-0 w-full justify-around"
                >
                  <div class="flex gap-1">
                    <div class="flex flex-col items-center">
                      <div
                        class="h-[24px] w-[24px] flex justify-center items-center bg-[#ffff00] rounded-full"
                      >
                        <div
                          class="h-[14px] w-[14px] bg-[#000] rounded-full"
                        ></div>
                      </div>
                      <p class="text-[12px] font-medium">TTL</p>
                    </div>
                    <div class="flex flex-col items-center">
                      <div
                        class="h-[24px] w-[24px] flex justify-center items-center bg-[#ffff00] rounded-full"
                      >
                        <div
                          class="h-[14px] w-[14px] bg-[#000] rounded-full"
                        ></div>
                      </div>
                      <p class="text-[12px] font-medium">TTL Enable</p>
                    </div>
                  </div>
                  <div class="flex flex-col items-center">
                    <div
                      class="h-[22px] w-[22px] border-4 border-black bg-[#ff0000] rounded-full"
                    ></div>
                    <p class="text-[12px] font-medium">reset</p>
                  </div>
                </div>
                <!-- <div class="flex justify-center mt-8">
                                <button onclick="generateAmplitudeModulatedSignal()"
                                    class="bg-[#008000] py-1 px-3 rounded-md hover:bg-[#0c9c0c] hover:scale-105">
                                    Generate
                                </button>
                            </div> -->
              </div>
            </div>
            <div class="flex px-8 mt-6 mb-8 gap-20">
              <!-- variable dc -->
              <div
                class="relative bg-[#a9a9a9] p-1 pt-0 border-4 shadow-[5px_5px_5px_5px_rgba(0,0,0,0.6)] border-black w-[140px] h-[250px]"
              >
                <h5 class="text-center text-sm font-medium">Variable DC</h5>
                <div class="flex mt-6 flex-col items-end">
                  <div class="flex flex-col items-start">
                    <div
                      class="h-[24px] w-[24px] flex justify-center items-center bg-[#ff0000] rounded-full"
                    >
                      <div
                        class="h-[14px] w-[14px] bg-[#000] rounded-full"
                      ></div>
                    </div>
                    <p class="text-[12px] font-medium">+5V</p>
                  </div>
                </div>

                <!--  -->
                <div class="flex flex-col items-end mt-10">
                  <div class="flex flex-col items-start">
                    <div
                      class="h-[24px] w-[24px] flex justify-center items-center bg-[#ffff00] rounded-full"
                    >
                      <div
                        class="h-[14px] w-[14px] bg-[#000] rounded-full"
                      ></div>
                    </div>
                    <p class="text-[12px] font-medium">DC</p>
                  </div>
                  <div class="flex flex-col items-start">
                    <div
                      class="h-[24px] w-[24px] flex justify-center items-center bg-[#00ff00] rounded-full"
                    >
                      <div
                        class="h-[14px] w-[14px] bg-[#000] rounded-full"
                      ></div>
                    </div>
                    <p class="text-[12px] font-medium">GND</p>
                  </div>
                </div>
              </div>
              <!-- master signal -->
            </div>
          </div>
          <div class="flex flex-col grow-0 items-center">
            <div class="w-full my-3">
              <div class="flex justify-between m-2">
                <div class="flex flex-1 justify-center gap-1 items-center">
                  <p class="text-nowrap font-medium">Sampling frequency :</p>
                  <input
                    class="border px-1 w-[152px] py-1 rounded-sm border-black"
                    min="1"
                    type="number"
                    id="fs"
                    value="1000"
                    placeholder="sampling frequency in Hz"
                  />
                </div>
                <div class="flex flex-1 justify-center items-center gap-1">
                  <p class="font-medium">Kf:</p>
                  <input
                    class="border px-1 w-[152px] py-1 rounded-sm border-black"
                    type="number"
                    id="kf"
                    min="1"
                    value="50"
                  />
                  <button
                    class="bg-blue-500 hover:scale-105 ml-1 text-white rounded-md px-2 py-1"
                    onclick="createPlots()"
                  >
                    Generate
                  </button>
                </div>
              </div>
            </div>
            <div class="bg-red-50 plotSection">
                <div id="modulatedPlot" class="w-[600px] max-h-[500px]"></div>
                <div id="carrierPlot" class="w-[600px] max-h-[500px]"></div>
                <div id="messagePlot" class="w-[600px] max-h-[500px]"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      function handleMessageFrequencyChange() {
        const messageValue = parseFloat(
          document.getElementById("messageFrequency").value
        );
        document.querySelector(".messageFrequencyDiv").innerHTML = messageValue;
      }
      function handleCarrierFrequencyChange() {
        const messageValue = parseFloat(
          document.getElementById("carrierFrequency").value
        );
        document.querySelector(".carrierFrequencyDiv").innerHTML = messageValue;
      }
      // Function for generating message signal
      function generateMessage() {
        var message_frequency = parseInt(
          document.getElementById("messageFrequency").value
        );
        var fs = parseInt(document.getElementById("fs").value);
        var numpoints = 10000; // Number of points for the signal
        var x_values = Array.from(
          { length: numpoints },
          (_, i) => i * (1 / (message_frequency * numpoints))
        );
        var message_signal = x_values.map((x) =>
          Math.sin(2 * Math.PI * message_frequency * x)
        );

        var messagePlotDiv = document.getElementById("messagePlot");
        Plotly.newPlot(
          messagePlotDiv,
          [
            {
              x: x_values,
              y: message_signal,
              mode: "lines",
              name: "Message Signal",
              line: { color: "green" },
            },
          ],
          {
            title: "Message Signal",
            xaxis: {
              title: "Time",
            },
            yaxis: {
              title: "Amplitude",
            },
          }
        );
      }

      // Function for generating carrier signal
      function generateCarrier() {
        var carrier_frequency = parseInt(
          document.getElementById("carrierFrequency").value
        );
        var message_frequency = parseInt(
          document.getElementById("messageFrequency").value
        );
        var fs = parseInt(document.getElementById("fs").value);
        var numpoints = 10000; // Number of points for the signal
        var x_values = Array.from(
          { length: numpoints },
          (_, i) => i * (1 / (message_frequency * numpoints))
        );
        var carrier_signal = x_values.map((x) =>
          Math.sin(2 * Math.PI * carrier_frequency * x)
        );

        var carrierPlotDiv = document.getElementById("carrierPlot");
        Plotly.newPlot(
          carrierPlotDiv,
          [
            {
              x: x_values,
              y: carrier_signal,
              mode: "lines",
              name: "Carrier Signal",
              line: { color: "red" },
            },
          ],
          {
            title: "Carrier Signal",
            xaxis: {
              title: "Time",
            },
            yaxis: {
              title: "Amplitude",
            },
          }
        );
      }

      // Function for frequency modulation
      function createPlots() {
        var message_frequency = parseInt(
          document.getElementById("messageFrequency").value
        );
        var carrier_frequency = parseInt(
          document.getElementById("carrierFrequency").value
        );
        var fs = parseInt(document.getElementById("fs").value);
        var kf = parseInt(document.getElementById("kf").value);
        var data = processing_fm(message_frequency, carrier_frequency, fs, kf);

        // Plot frequency-modulated signal
        var modulatedPlotDiv = document.getElementById("modulatedPlot");
        Plotly.newPlot(
          modulatedPlotDiv,
          [
            {
              x: data.x,
              y: data.modulated,
              mode: "lines",
              name: "Frequency Modulated Signal",
              line: { color: "blue" },
            },
          ],
          {
            title: "Frequency Modulated Signal",
            xaxis: {
              title: "Time",
            },
            yaxis: {
              title: "Amplitude",
            },
          }
        );
      }

      // Function for frequency modulation
      function processing_fm(
        message_frequency,
        carrier_frequency,
        fs,
        kf,
        numpoints = 10000
      ) {
        var x_values = Array.from(
          { length: numpoints },
          (_, i) => i * (1 / (message_frequency * numpoints))
        );
        var message_signal = x_values.map((x) =>
          Math.sin(2 * Math.PI * message_frequency * x)
        );
        var carrier_signal = x_values.map((x) =>
          Math.sin(2 * Math.PI * carrier_frequency * x)
        );

        var phase_deviation = new Array(numpoints).fill(0);
        for (var i = 1; i < numpoints; i++) {
          for (var j = 0; j <= i; j++) {
            phase_deviation[i] += message_signal[j];
          }
          phase_deviation[i] *= kf * (message_frequency / fs) * 2 * Math.PI;
        }

        var modulated_signal = x_values.map((x, i) =>
          Math.sin(2 * Math.PI * carrier_frequency * x + phase_deviation[i])
        );

        return {
          x: x_values,
          message: message_signal,
          carrier: carrier_signal,
          modulated: modulated_signal,
        };
      }
    </script>
  </body>
</html>
