<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Virtual Labs</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  </head>
  <body>
    <!-- sidebar and body -->
    <div class="flex min-h-[80vh]">
      <div class="px-6 pb-6 flex-1">
        <div class="flex flex-shrink-0">
          <div class="relative w-[700px] py-2">
            <div
              class="absolute bg-[#ff0000] h-[90px] w-2 rounded-md top-[170px] left-[220px]"
            ></div>
            <div
              class="z-10 absolute bg-[#ff0000] h-2 w-[44px] rounded-md top-[254px] left-[184px]"
            ></div>
            <div
              class="z-10 absolute bg-[#ff0000] h-2 w-[64px] rounded-md top-[170px] left-[224px]"
            ></div>

            <div
              class="absolute bg-[#0000ff] h-[110px] w-2 rounded-md top-[170px] right-[236px]"
            ></div>
            <div
              class="z-10 absolute bg-[#0000ff] h-2 w-[90px] rounded-md top-[170px] right-[236px]"
            ></div>
            <div
              class="z-10 absolute bg-[#0000ff] h-2 w-[86px] rounded-md top-[272px] right-[158px]"
            ></div>
            <div
              class="z-10 absolute bg-black h-2 w-[80px] rounded-md top-[272px] -right-2"
            >
            <p class="text-end pt-1 font-medium">CH2-B</p>
            </div> 
            <div class="absolute top-[100px] left-[50px]">
                <p class="font-medium text-center my-2 text-[24px]">AM Signal</p>
                <div>
                    <!-- message frequency -->
                    <div class="flex flex-col mb-2 items-center">
                      <p class="text-[13px] pb-1 text-center font-bold">
                        Message Frequency
                      </p>
                      <input
                        id="frequency"
                        value="1"
                        type="range"
                        min="1"
                        max="10000"
                        onchange="handleMessageFrequencyChange()"
                      />
                      <div class="leading-none messageFrequencyDiv">1</div>
                    </div>
                    <!-- carrier frequency -->
                    <div class="flex flex-col items-center">
                      <p class="text-[13px] pb-1 font-bold">Carrier Frequency:</p>
                      <input
                        id="amplitude"
                        value="100"
                        type="range"
                        max="10000"
                        onchange="handleCarrierFrequencyChange()"
                      />
                      <div class="leading-none carrierFrequencyDiv">100</div>

                    </div>
                    <!--  -->
                  </div>
            </div>
            <div class="flex justify-end p-8 pr-12 gap-28">
              <!-- utilities -->
              <div
                class="relative bg-[#a9a9a9] p-1 pt-0 border-4 shadow-[5px_5px_5px_5px_rgba(0,0,0,0.6)] border-black w-[140px] h-[270px]"
              >
                <h5 class="text-center text-sm font-medium">UTILITIES</h5>
                <div class="flex justify-between px-1 pt-1">
                  <div class="flex flex-col items-center">
                    <div
                      class="h-[24px] w-[24px] border-[5px] border-[#ffff00] bg-black rounded-full"
                    ></div>
                    <p class="text-[12px] font-medium">REF</p>
                  </div>
                  <div
                    class="h-[24px] w-[24px] border-[5px] border-[#ffff00] bg-black rounded-full"
                  ></div>
                </div>
                <div class="flex justify-between px-1 pt-1">
                  <div
                    class="h-[24px] w-[24px] border-[5px] border-[#ffff00] bg-black rounded-full"
                  ></div>
                  <div
                    class="h-[24px] w-[24px] border-[5px] border-[#ffff00] bg-black rounded-full"
                  ></div>
                </div>
                <p class="text-sm text-center border-b border-black font-medium">
                  COMPARATOR
                </p>
                <div class="flex justify-between px-1 pt-1">
                  <div
                    class="h-[24px] w-[24px] border-[5px] border-[#ffff00] bg-black rounded-full"
                  ></div>
                  <div
                    class="h-[24px] w-[24px] border-[5px] border-[#ffff00] bg-black rounded-full"
                  ></div>
                </div>
                <p class="text-sm text-center border-b border-black font-medium">
                  RECTIFIER
                </p>

                <div class="flex justify-between px-1 pt-1">
                  <div
                    class="h-[24px] w-[24px] border-[5px] border-[#ffff00] bg-black rounded-full"
                  ></div>
                  <div
                    class="h-[24px] w-[24px] border-[5px] border-[#ffff00] bg-black rounded-full"
                  ></div>
                </div>
                <p class="text-sm text-center border-b border-black font-medium">
                  DIODE + LPF
                </p>

                <div class="flex justify-between px-1 pt-1">
                  <div
                    class="h-[24px] w-[24px] border-[5px] border-[#ffff00] bg-black rounded-full"
                  ></div>
                  <div
                    class="h-[24px] w-[24px] border-[5px] border-[#ffff00] bg-black rounded-full"
                  ></div>
                </div>
                <p class="text-sm text-center border-b border-black font-medium">RC LPF</p>
              </div>
              <!-- TUNABLE LPF -->
              <div
                class="relative bg-[#a9a9a9] p-1 pt-0 border-4 shadow-[5px_5px_5px_5px_rgba(0,0,0,0.6)] border-black w-[140px] h-[270px]"
              >
                <h5 class="text-center text-sm font-medium">TUNABLE LPF</h5>
                <div class="flex mt-6 flex-col items-end">
                  <div class="flex flex-col items-start">
                    <div
                      class="h-[24px] w-[24px] border-[5px] border-[#ff0000] bg-black rounded-full"
                    ></div>
                    <p class="text-[12px] font-medium">CLK</p>
                  </div>
                </div>
                <div class="flex flex-col items-center justify-center gap-3">
                  <div class="flex flex-col items-center">
                    <div
                      class="h-[26px] w-[26px] border-[4px] relative shadow-black shadow-lg border-black bg-[#ffff00] rounded-full"
                    >
                      <div
                        class="w-1 h-2 absolute top-[50%] left-[40%] bg-black"
                      ></div>
                    </div>
                    <p class="text-[12px] font-medium">TUNE</p>
                  </div>
                  <div class="flex flex-col items-center">
                    <div
                      class="h-[26px] w-[26px] relative border-[4px] shadow-black shadow-md border-black bg-[#ffff00] rounded-full"
                    >
                      <div
                        class="w-1 h-2 absolute top-[50%] left-[40%] bg-black"
                      ></div>
                    </div>
                    <p class="text-[12px] font-medium">GAIN</p>
                  </div>
                </div>
                <!--  -->
                <div
                  class="flex items-center justify-between px-2 gap-8 absolute bottom-0 w-full"
                >
                  <div class="flex flex-col items-start">
                    <div
                      class="h-[24px] w-[24px] border-[5px] border-[#ffff00] bg-black rounded-full"
                    ></div>
                    <p class="text-[12px] font-medium">IN</p>
                  </div>
                  <div class="flex flex-col items-start">
                    <div
                      class="h-[24px] w-[24px] border-[5px] border-[#ffff00] bg-black rounded-full"
                    ></div>
                    <p class="text-[12px] font-medium">OUT</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="flex flex-col grow-0 items-center">
            <div class="w-full my-3">
              <div class="flex justify-between m-2">
                <div class="flex flex-1 items-center gap-3">
                  <p class="font-medium">Cut-off Frequency:</p>
                  <input
                    class="border px-1 w-[152px] py-1 rounded-sm border-black"
                    type="number"
                    id="cutoff"
                    value="1"
                  />
                  <button
                    class="bg-blue-500 text-white py-1 px-3  rounded-md hover:scale-105"
                    onclick="createPlots()"
                  >
                    Generate
                  </button>
                </div>
              </div>
            </div>
            <div class="bg-red-50 plotSection">
              <div id="demodulatedPlot" class="w-[600px] max-h-[450px]"></div>
              <div id="modulatedPlot" class="w-[600px] max-h-[450px]"></div>
              <div id="messagePlot" class="w-[600px] max-h-[450px]"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
        function handleMessageFrequencyChange() {
        const messageValue = parseFloat(
          document.getElementById("frequency").value
        );
        document.querySelector(".messageFrequencyDiv").innerHTML = messageValue;
      }
      function handleCarrierFrequencyChange() {
        const messageValue = parseFloat(
          document.getElementById("amplitude").value
        );
        document.querySelector(".carrierFrequencyDiv").innerHTML = messageValue;
      }
      // JavaScript code for amplitude demodulation
      function amplitudeDemodulation(frequency, amplitude, A1, B1, numPoints = 10000) {
          const xValues = [];
        const message = [];
          const yValues = [];
          const demodulatedSignal = [];
      
          // Generate x values
          for (let i = 0; i < numPoints; i++) {
              xValues.push(i * (5 / (frequency * numPoints)));
          }
      
          // Generate y values
            for (let i = 0; i < numPoints; i++) {
              message.push(Math.sin(2 * Math.PI * frequency * xValues[i]));
          }
        
          for (let i = 0; i < numPoints; i++) {
              yValues.push((B1 + (A1 * Math.sin(2 * Math.PI * frequency * xValues[i]))) * Math.sin(2 * Math.PI * amplitude * xValues[i]));
          }
      
          // Amplitude Demodulation
          for (let i = 0; i < numPoints; i++) {
              demodulatedSignal.push(yValues[i] * Math.sin(2 * Math.PI * amplitude * xValues[i]));
          }
      
          // Low-pass filter to remove high-frequency components
          const cutoffFrequency = parseFloat(document.getElementById('cutoff').value);
          const filteredSignal = lowPassFilter(demodulatedSignal, cutoffFrequency);
      
          return { "x": xValues, "demodulated": filteredSignal, "message": message, "modulated": yValues };
      }
      
      // Low-pass filter function
      function lowPassFilter(signal, cutoffFrequency) {
          const filteredSignal = [];
          // Implement your low-pass filter logic here
          // Example: Applying moving average filter
          const filterLength = 10; // Filter length (adjust as needed)
          for (let i = 0; i < signal.length; i++) {
              let sum = 0;
              const startIdx = Math.max(0, i - filterLength + 1);
              for (let j = startIdx; j <= i; j++) {
                  sum += signal[j];
              }
              filteredSignal.push(sum / filterLength);
          }
          return filteredSignal;
      }
      
      // Function to create plots
      function createPlots() {
          var frequency = parseFloat(document.getElementById('frequency').value);
          var amplitude = parseFloat(document.getElementById('amplitude').value);
          var A1 =1; //  parseFloat(document.getElementById('A1').value);
          var B1 =1; //  parseFloat(document.getElementById('B1').value);
      
          var data = amplitudeDemodulation(frequency, amplitude, A1, B1);
      
          // Plot message signal
          var messagePlotDiv = document.getElementById('messagePlot');
          Plotly.newPlot(messagePlotDiv, [{
              x: data.x,
              y: data.message,
              mode: 'lines',
              name: 'Message Signal',
              line: {color: 'green'}
          }], {
              title: 'Message Signal',
              xaxis: {
                  title: 'Time'
              },
              yaxis: {
                  title: 'Amplitude'
              }
          });
      
          // Plot modulated signal
          var modulatedPlotDiv = document.getElementById('modulatedPlot');
          Plotly.newPlot(modulatedPlotDiv, [{
              x: data.x,
              y: data.modulated,
              mode: 'lines',
              name: 'Modulated Signal',
              line: {color: 'red'}
          }], {
              title: 'Modulated Signal',
              xaxis: {
                  title: 'Time'
              },
              yaxis: {
                  title: 'Amplitude'
              }
          });
      
          // Plot demodulated signal
          var demodulatedPlotDiv = document.getElementById('demodulatedPlot');
          Plotly.newPlot(demodulatedPlotDiv, [{
              x: data.x,
              y: data.demodulated,
              mode: 'lines',
              name: 'Demodulated Signal',
              line: {color: 'blue'}
          }], {
              title: 'Amplitude Demodulated Signal',
              xaxis: {
                  title: 'Time'
              },
              yaxis: {
                  title: 'Amplitude'
              }
          });
      }
      </script>
  </body>
</html>
